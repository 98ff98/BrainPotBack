CREATE DATABASE `BRAINPOT`;
USE `BRAINPOT`;


CREATE TABLE `USER` (
	  `ID` INT NOT NULL UNIQUE PRIMARY KEY ,
    `TEAM` INT NOT NULL,
    `ADMIN` BOOLEAN NOT NULL,
    `NICKNAME` CHAR(10) NOT NULL,
    FOREIGN KEY(`TEAM`) REFERENCES `TEAM`(`ID`) ON UPDATE CASCADE ON DELETE CASCADE,

    KEY `IDX_ID`(`ID`)
);

#테이블 구조 조회
DESC `USER`;

#검색 쿼리
SELECT * FROM `USER`;

#샘플 데이터 삽입 쿼리문
INSERT INTO `USER`(`TEAM`, `ADMIN`, `NICKNAME`) VALUES (5, FALSE, 'Hyeri');

#어드민 유저 추가 스토어드 프로시저
DELIMITER @@;

CREATE PROCEDURE `ADD_ADMIN_USER`(IN `ID` INT, IN `TEAM` INT, IN `NICKNAME` CHAR(10))

    BEGIN
        INSERT INTO `USER`(`ID`,`TEAM`, `ADMIN`, `NICKNAME`) VALUES (`ID`, `TEAM`,TRUE , `NICKNAME`);

    END @@;

DELIMITER ;

#프로시저 삭제
DROP PROCEDURE `ADD_ADMIN_USER`;
DROP PROCEDURE `ADD_NORMAL_USER`;

#어드민 유저 추가 스토어드 프로시저
DELIMITER @@;

CREATE PROCEDURE `ADD_NORMAL_USER`(IN `ID` INT, IN `TEAM` INT, IN `NICKNAME` CHAR(10))

    BEGIN
        INSERT INTO `USER`(`ID`,`TEAM`, `ADMIN`, `NICKNAME`) VALUES (`ID`, `TEAM`,TRUE , `NICKNAME`);

    END @@;

DELIMITER ;

#해당 ID를 가지고 있는 유저가 있는지 확인
DELIMITER @@;

CREATE PROCEDURE `CHECK_ID`(IN `CREATEDID` INT)

    BEGIN
        SELECT `TEAM` FROM `USER` WHERE `ID` = CREATEDID;
    END @@;

DELIMITER ;

CALL `CHECK_ID`(1);

#스토어드 프로시저 호출
CALL `ADD_ADMIN_USER`(1, 5, 'HYERI7');

#### DANGER!! ####
DROP TABLE `USER`;