CREATE DATABASE `BRAINPOT`;
USE `BRAINPOT`;


CREATE TABLE `NODE` (
    `ID` INT NOT NULL,
    `OWNERTEAM` INT NOT NULL,
    `OWNERUSER` INT NOT NULL,
    `CONTENT` TEXT NOT NULL,
    FOREIGN KEY(`OWNERTEAM`) REFERENCES `TEAM`(`ID`) ON UPDATE CASCADE ON DELETE CASCADE,
    PRIMARY KEY (`ID`, `OWNERUSER`)
);

#튜플 조회
SELECT * FROM `NODE`;

#노드 추가 프로시저
DELIMITER @@;
CREATE PROCEDURE `ADD_NODE`(IN `NODE_ID` INT, IN `OWNER_TEAM` INT, IN `OWNER_USER` INT, IN `NODE_CONTENT` TEXT)
  BEGIN
    INSERT INTO `NODE`(`ID`,`OWNERTEAM`, `OWNERUSER`, `CONTENT`) VALUES (`NODE_ID`, `OWNER_TEAM`, `OWNER_USER`, `NODE_CONTENT`);
  END @@;
DELIMITER ;


#노드 삭제 프로시저
DELIMITER @@;
  CREATE PROCEDURE `DROP_NODE`(IN `NODE_ID` INT, IN `USER` INT)
    BEGIN
      DELETE FROM `NODE` WHERE `ID` = `NODE_ID` AND `OWNERUSER` = `USER`;
    END @@;
DELIMITER ;

#노드 조회 프로시저
DELIMITER @@;
CREATE PROCEDURE `VIEW_NODES`(IN `TEAM_ID` INT)
  BEGIN
    SELECT * FROM `NODE` WHERE `OWNERTEAM` = `TEAM_ID`;
  END @@;
DELIMITER ;


#### DANGER!! ####
DROP TABLE `NODE`;